<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Lattes JCR Parser</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="icon" href="assets/favicon.ico" sizes="any">
  <link rel="icon" type="image/png" sizes="32x32" href="assets/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="assets/favicon-16x16.png">
</head>
<body>
  <main>
<header class="card">
  <div style="display:flex; align-items:flex-start; gap:16px;">

    <!-- Logo do projeto -->
    <img src="assets/lattes-jcr-parser.png"
         alt="Lattes JCR Parser"
         style="height:120px; width:auto;" />

    <!-- Título -->
    <div>
      <h1 style="margin:0;">Lattes JCR Parser</h1>
      <p class="hint" style="margin:4px 0 0 0;">
        Extração e somatório do fator de impacto baseado no JCR (Journal Citation Reports) a partir do HTML completo do Currículo Lattes, com execução local no navegador.
      </p>
    </div>

    <!-- Logos institucionais (secundários) -->
    <div style="display:flex; align-items:center; gap:8px; margin-left:auto;">
      <img src="assets/lattes.png"
           alt="Logo Lattes CNPq"
           style="height:50px; width:auto;" />
      <img src="assets/o2.png"
           alt="Logo Observatório Oceanográfico"
           style="height:50px; width:auto;" />
    </div>

  </div>
</header>


<section class="card">
  <br><br>
  <h2 style="margin-top:0;">1) Gere o arquivo correto</h2>

  <p>
    Este aplicativo requer que o Currículo Lattes seja salvo como <strong>HTML completo</strong> (página completa),
    incluindo a pasta de arquivos associada.
  </p>

  <p class="hint">
    Importante: o HTML salvo pelo <strong>Google Chrome</strong> frequentemente não preserva corretamente elementos e metadados
    usados pelo Lattes (incluindo o conteúdo associado ao ícone “jcr”), o que pode resultar em extração incompleta.
    Recomenda-se fortemente salvar pelo <strong>Mozilla Firefox</strong>, usando a opção “Página completa”.
  </p>

  <p class="hint">
    Arquivos <code>.mhtml</code> não são suportados.
  </p>
</section>

<section class="card">
  <h2 style="margin-top:0;">2) Faça upload do HTML e processe</h2>

  <label for="fileInput"><strong>Arquivo HTML do Lattes</strong></label><br />
  <input type="file" id="fileInput" accept=".html,.htm" />

  <div class="controls" style="margin-top:12px;">
    <label for="previewLimit">
      Pré-visualização:
      <select id="previewLimit">
        <option value="10">10 linhas</option>
        <option value="50">50 linhas</option>
        <option value="200">200 linhas</option>
        <option value="all">Todas</option>
      </select>
    </label>

    <div class="buttons">
      <button id="processBtn" disabled>Processar</button>
      <button id="downloadBtn" disabled>Baixar Excel</button>
    </div>
  </div>

  <!-- Bloco de intervalo de anos -->
  <div id="yearRangeBox" style="display:none; margin-top:12px;">
    <label>
      Ano inicial:
      <input type="number" id="yearFrom" placeholder="ex: 2015">
    </label>

    <label style="margin-left:12px;">
      Ano final:
      <input type="number" id="yearTo" placeholder="ex: 2025">
    </label>

    <button id="calcBtn" style="margin-left:12px;" disabled>
      Calcular somatório
    </button>

    <p class="hint" style="margin-top:8px;">
      O somatório usa apenas registros cujo HTML contém o valor de IF no JCR (ícone “jcr” com tooltip).
    </p>
  </div>

  <div id="summary" class="summary" style="margin-top:12px;"></div>

  <div class="hint" style="margin-top:12px;">
    <br><br><br>
    <strong>Disclaimer</strong><br>
    O arquivo Excel gerado deve ser conferido pelo usuário antes de qualquer uso em relatórios, editais ou avaliações.
    Em caso de inconsistências, verifique primeiro se o lançamento no Lattes está correto e se o HTML foi salvo como
    “Página completa” no Firefox.
    <br><br>
  </div>
</section>

<section class="card">
  <h2 style="margin-top:0;">Pré-visualização</h2>
  <div class="table-wrap">
    <table id="preview" aria-label="Pré-visualização dos artigos extraídos"></table>
  </div>
</section>
<section class="card">
  <br><br>
  <h2 style="margin-top:0;">IF acumulado por ano (JCR)</h2>
  <canvas id="jcrChart" height="100"></canvas>
  <br><br>
</section>
<footer class="footer">
  <small>
    Privacidade e execução local: todo o processamento ocorre em client-side. Nenhum dado é enviado, armazenado ou transmitido para servidores externos.<br>
    Nota técnica: o IF do JCR é extraído do tooltip do ícone “jcr” no HTML do Lattes (atributo <code>original-title</code>). Se o HTML não contiver esses ícones, as colunas de JCR ficarão vazias.
    <br><br>

    <strong>Links úteis</strong><br>
    <a href="WHYNOT.md" target="_blank">Por que usar Firefox em vez de Chrome</a><br>
    <a href="https://github.com/andrebelem/lattes-jcr-parser" target="_blank">Repositório no GitHub</a><br>
    <a href="https://buymeacoffee.com/andrebelem" target="_blank">Buy me a coffee</a>
  </small>
</footer>

  </main>

  <script src="app.js"></script>
</body>
</html>
